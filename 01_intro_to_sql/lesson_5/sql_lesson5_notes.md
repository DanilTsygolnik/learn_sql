# Конспект

---

## Сортировка

В абсолютном большинстве случаев требуется получать наборы данных в виде, отсортированном по одному из столбцов.

Сортировка набора -- это упорядочение записей набора по значению определенного поля, в порядке возрастания или убывания.

Если итоговый набор требуется отсортировать по значению определенного поля, следует воспользоваться предложением `ORDER BY`. После этих ключевых слов указывается поле, по которому выполняется сортировка. По умолчанию сортировка выполняется по возрастанию. Если требуется выполнить сортировку по убыванию, после имени поля надо добавить ключевое слово `DESC`.

Например:
```sql
SELECT *  FROM Orders ORDER BY OrderDate DESC;
```

Будут показаны все заказы в порядке от самого нового до самого старого (по убыванию даты).

Сортировка заказчиков по имени-фамилии контактного лица запишется так:
```sql
SELECT * FROM Customers ORDER BY ContactName;
```
Выходной набор будет упорядочен по алфавиту имени-фамилии заказчика.

Если для упорядочения задано несколько полей, выполняется многоуровневая сортировка. Записи сначала сортируются по первому указанному полю, при совпадении значений выполняется сортировка во следующему полю и так далее. Например:
```sql
SELECT * FROM Customers ORDER BY Country, ContactName;
```
Результирующий набор будет упорядочен по полю Country. Записи с одинаковыми названиями стран дополнительно сортируются по имени.

---

## Проверка неопределенных полей

В таблицах нередко встречаются поля с неопределенными значениями. Их содержимое нельзя явно сравнивать с помощью вышеописанных операций. Единственное допустимое в отношении таких полей действие -- проверка на неопределенность. Она выполняется командой `IS NULL`. Например:
```sql
SELECT * FROM Customers 
WHERE Region IS NULL
ORDER BY Country, ContactName;
```
В результирующий набор попадут записи, у которых значение поля Region не определено.

---

## Агрегирование

Функции агрегирования обрабатывают все значения столбца (поля) таблицы базы данных. Они позволяют получить обобщенные, итоговые результаты.

**Агрегирование** -- это класс операций, разово выполняемых над всеми записями набора данных.

---

### Типовые операции агрегирования

Пусть, например, требуется посчитать, сколько всего единиц товара у нас хранится на складе. Это поле UnitsInStock таблицы Products.

Функция `SUM` определяет сумму всех значений заданного поля. Имя нужного поля указывается в качестве параметра `SUM()`:
```sql
SELECT SUM(UnitsInStock) FROM Products;
```
Такая команда вернет не набор записей, а значение агрегированной функции `SUM` для всего набора. В данном примере оно равно 3119 (в зависимости от версии базы данных Northwind).

К часто применяемым функциям агрегирования относятся функции `AVG` (вычисление среднего значения), `MIN` и `MAX` (поиск минимального и максимального значений).

---

### Подсчёт количества значений

Функция `COUNT` вообще не обрабатывает значения поля, а просто считает количество значений данного поля в таблице, не учитывая нулевые и неопределенные. Например:
```sql
SELECT COUNT(RegionId) FROM Region;
```
В таблице будет обнаружено 4 значения. Если требуется узнать общее число записей в таблице, вместо имени поля можно поставить символ `*`.

---

### Уточнение работы функций

Работу функции `COUNT` можно уточнять с помощью дополнительных предложений. Пусть надо подчитать число уникальных значений в определенном столбце (без учета повторяющихся значений). Перед параметром функции (именем поля) в круглых скобках дополнительно ставится ключевое слово `DISTINCT`:
```sql
SELECT COUNT(DISTINCT ContactType) FROM Contacts;
```
С учетом повторений в таблице обнаруживается 4 значения, при том, что всего в таблице 133 значения.

Предикат `DISTINCT` можно применять и в других функциях агрегирования, например в функции `SUM`. Нередко требуется, чтобы функция работала, учитывая все поля, как с повторяющимися, так и с неповторяющимися значениями. Это важно, например, при подсчете бюджета -- у разных отделов могут быть одинаковые бюджеты. В такой ситуации вместо `DISTINCT` используют ключевое слово `ALL`, прямо противоположное `DISTINCT` по смыслу.

---

# Практика

Закрепление теории и ход работы в ![отчете](sql_lesson5_prac.md).

---
